<!DOCTYPE html><html lang="en" data-theme="dark" class="dark" data-astro-cid-bvzihdzo> <head><!-- Global Metadata --><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png?v=1"><link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png?v=1"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png?v=1"><link rel="icon" type="image/png" href="/favicon.png?v=1"><link rel="shortcut icon" href="/favicon.ico?v=1"><link rel="sitemap" href="/sitemap-index.xml"><link rel="alternate" type="application/rss+xml" title="Site Author – Personal Blog &#38; Portfolio" href="https://example.com/rss.xml"><meta name="generator" content="Astro v5.12.9"><!-- Font preloads --><link rel="preload" href="/fonts/atkinson-regular.woff" as="font" type="font/woff" crossorigin><link rel="preload" href="/fonts/atkinson-bold.woff" as="font" type="font/woff" crossorigin><!-- Canonical URL --><link rel="canonical" href="https://example.com/blog/making-a-game-engine-in-rust-03-ecs/"><!-- Robots --><meta name="robots" content="index,follow,max-image-preview:large"><!-- Theme color (supports dark/light) --><meta name="theme-color" media="(prefers-color-scheme: light)" content="#ffffff"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#0b0b0b"><!-- Primary Meta Tags --><title>Making a Game Engine in Rust 03: ECS</title><meta name="title" content="Making a Game Engine in Rust 03: ECS"><meta name="description" content="This post covers the creation of a basic ECS for the game engine."><!-- Open Graph / Facebook --><meta property="og:type" content="website"><meta property="og:site_name" content="Site Author – Personal Blog &#38; Portfolio"><meta property="og:locale" content="en_US"><meta property="og:url" content="https://example.com/blog/making-a-game-engine-in-rust-03-ecs/"><meta property="og:title" content="Making a Game Engine in Rust 03: ECS"><meta property="og:description" content="This post covers the creation of a basic ECS for the game engine."><meta property="og:image" content="https://example.com/_astro/blog-placeholder-1.Bx0Zcyzv.jpg"><meta property="og:image:alt" content="Making a Game Engine in Rust 03: ECS"><!-- Twitter --><meta name="twitter:card" content="summary_large_image"><meta name="twitter:site" content="@guihubie"><meta property="twitter:url" content="https://example.com/blog/making-a-game-engine-in-rust-03-ecs/"><meta property="twitter:title" content="Making a Game Engine in Rust 03: ECS"><meta property="twitter:description" content="This post covers the creation of a basic ECS for the game engine."><meta property="twitter:image" content="https://example.com/_astro/blog-placeholder-1.Bx0Zcyzv.jpg"><meta property="og:type" content="article"><!-- Article specific OG meta --><meta property="article:published_time" content="2024-09-09T00:00:00.000Z"><meta property="article:author" content="Site Author"><meta property="article:tag" content="rust"><meta property="article:tag" content="game-engine"><!-- JSON-LD: Article --><script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"Making a Game Engine in Rust 03: ECS","description":"This post covers the creation of a basic ECS for the game engine.","datePublished":"2024-09-09T00:00:00.000Z","author":[{"@type":"Person","name":"Site Author"}],"publisher":{"@type":"Organization","name":"guihubie.com"},"mainEntityOfPage":"https://example.com/blog/making-a-game-engine-in-rust-03-ecs/","url":"https://example.com/blog/making-a-game-engine-in-rust-03-ecs/"}</script><!-- JSON-LD: Breadcrumbs --><script type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Home","item":"https://example.com/"},{"@type":"ListItem","position":2,"name":"Blog","item":"https://example.com/blog/"},{"@type":"ListItem","position":3,"name":"Making a Game Engine in Rust 03: ECS","item":"https://example.com/blog/making-a-game-engine-in-rust-03-ecs/"}]}</script><link rel="stylesheet" href="/_astro/about.DsQLGK1y.css">
<style>main[data-astro-cid-bvzihdzo]{width:1280px;max-width:calc(100% - 2em);margin:auto;background:var(--color-bg-primary)}.hero-image[data-astro-cid-bvzihdzo]{width:100%}.hero-image[data-astro-cid-bvzihdzo] img[data-astro-cid-bvzihdzo]{display:block;margin:0 auto;border-radius:12px;box-shadow:var(--box-shadow)}.prose[data-astro-cid-bvzihdzo]{width:100%;max-width:870px;margin:auto;padding:.05em;color:var(--color-text-secondary)}.title[data-astro-cid-bvzihdzo]{margin-bottom:1em;padding:1em 0;text-align:center;line-height:1}.title[data-astro-cid-bvzihdzo] h1[data-astro-cid-bvzihdzo]{margin:0 0 .5em;color:var(--color-text-primary)}.date[data-astro-cid-bvzihdzo]{margin-bottom:.5em;color:var(--color-text-muted)}.last-updated-on[data-astro-cid-bvzihdzo]{font-style:italic}
</style></head> <body data-astro-cid-bvzihdzo> <header class="bg-background text-foreground border-b sw-header"> <nav class="mx-auto max-w-6xl px-4 py-2 flex items-center justify-between"> <div class="flex items-center gap-3"> <a class="no-underline hover:opacity-90 flex items-center gap-2" href="/" aria-label="Home"> <img src="/favicon.png?v=1" alt="" aria-hidden="true" width="45" height="45"> </a> <div class="internal-links hidden md:flex items-center gap-2 ml-1"> <a href="/" class="px-2 py-3 text-[color:var(--color-text-secondary)] no-underline" data-astro-cid-2dpnh6aj> Home </a>  <a href="/portfolio" class="px-2 py-3 text-[color:var(--color-text-secondary)] no-underline" data-astro-cid-2dpnh6aj> Portfolio </a>  <a href="/about" class="px-2 py-3 text-[color:var(--color-text-secondary)] no-underline" data-astro-cid-2dpnh6aj> About </a>  <a href="/blog" class="px-2 py-3 text-[color:var(--color-text-secondary)] no-underline active" data-astro-cid-2dpnh6aj> Blog </a>  <!-- <a href="#contact" class="px-2 py-3 text-[color:var(--color-text-secondary)] no-underline">Contact</a> --> </div> </div> <div class="flex items-center gap-3"> <div class="social-links hidden md:flex items-center gap-3"> <!-- <a href="https://x.com/guihubie" target="_blank" class="group text-[color:var(--color-text-secondary)]"> --> <!-- <span class="sr-only">Follow on Twitter</span> --> <!-- X icon --> <!-- <svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="transition-colors group-hover:text-[color:var(--accent)]"><path fill="currentColor" d="M18.146 3H21l-7.5 8.574L22.5 21h-6.297l-4.93-5.597L5.5 21H3l8.106-9.266L3 3h6.453l4.466 5.07L18.146 3Zm-1.103 16.2h1.705L7.05 4.64H5.272l11.771 14.56Z"/></svg> --> <!-- </a> --> <a href="https://github.com/Estikno" target="_blank" class="group text-[color:var(--color-text-secondary)]"> <span class="sr-only">Go to GitHub</span> <svg viewBox="0 0 16 16" aria-hidden="true" width="24" height="24" class="transition-colors group-hover:text-[color:var(--accent)]"><path fill="currentColor" d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.012 8.012 0 0 0 16 8c0-4.42-3.58-8-8-8z"></path></svg> </a> </div> <button type="button" class="sw-btn-sm no-underline flex items-center gap-1" aria-label="Toggle theme" aria-pressed="false" data-theme-toggle> <span class="sr-only">Toggle theme</span> <span class="theme-icon" aria-hidden="true"> <svg class="icon-sun" viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="4"></circle><path d="M12 2v2M12 20v2M4.93 4.93l1.41 1.41M17.66 17.66l1.41 1.41M2 12h2M20 12h2M4.93 19.07l1.41-1.41M17.66 6.34l1.41-1.41"></path></svg> <svg class="icon-moon" viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg> </span> <span class="label">Theme</span> </button> <script>
  (function () {
    const storageKey = 'theme';
    const root = document.documentElement;
    const btn = document.querySelector('[data-theme-toggle]');

    function applyTheme(theme) {
      const isDark = theme === 'dark';
      root.dataset.theme = isDark ? 'dark' : 'light';
      root.classList.toggle('dark', isDark);
      if (btn) btn.setAttribute('aria-pressed', String(isDark));
    }

    function getInitialTheme() {
      const saved = localStorage.getItem(storageKey);
      if (saved === 'dark' || saved === 'light') return saved;
      // Infer from current DOM as fallback
      return root.classList.contains('dark') || root.dataset.theme === 'dark' ? 'dark' : 'light';
    }

    let current = getInitialTheme();
    applyTheme(current);

    btn?.addEventListener('click', () => {
      current = current === 'dark' ? 'light' : 'dark';
      localStorage.setItem(storageKey, current);
      applyTheme(current);
    });
  })();
</script> <style>
  [data-theme-toggle] .icon-moon { display: none; }
  html[data-theme="dark"] [data-theme-toggle] .icon-sun { display: none; }
  html[data-theme="dark"] [data-theme-toggle] .icon-moon { display: inline; }
</style> <button type="button" aria-label="Open menu" aria-controls="mobile-menu" aria-expanded="false" data-menu-btn class="md:hidden inline-flex items-center justify-center w-10 h-10 rounded-lg text-[color:var(--color-text-secondary)] hover:text-white"> <svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true"><path fill="currentColor" d="M3 6h18v2H3V6Zm0 5h18v2H3v-2Zm0 5h18v2H3v-2Z"></path></svg> </button> </div> </nav> <div id="mobile-menu" class="md:hidden hidden border-t"> <div class="mx-auto max-w-6xl px-4 py-3 flex flex-col gap-2"> <div class="flex flex-col"> <a href="/" class="px-2 py-3" data-astro-cid-2dpnh6aj> Resume </a>  <a href="/portfolio" class="px-2 py-3" data-astro-cid-2dpnh6aj> Portfolio </a>  <a href="/about" class="px-2 py-3" data-astro-cid-2dpnh6aj> About </a>  <a href="/blog" class="px-2 py-3 active" data-astro-cid-2dpnh6aj> Blog </a>  <a href="#contact" class="px-2 py-3">Contact</a> </div> <div class="flex items-center gap-4 pt-2"> <a href="https://x.com/guihubie" target="_blank" class="group inline-flex items-center text-[color:var(--color-text-secondary)]"> <svg viewBox="0 0 24 24" width="22" height="22" aria-hidden="true" class="transition-colors group-hover:text-white"><path fill="currentColor" d="M18.146 3H21l-7.5 8.574L22.5 21h-6.297l-4.93-5.597L5.5 21H3l8.106-9.266L3 3h6.453l4.466 5.07L18.146 3Zm-1.103 16.2h1.705L7.05 4.64H5.272l11.771 14.56Z"></path></svg> </a> <a href="https://github.com/guihubie/free-astro-template" target="_blank" class="group inline-flex items-center text-[color:var(--color-text-secondary)]"> <svg viewBox="0 0 16 16" aria-hidden="true" width="22" height="22" class="transition-colors group-hover:text-white"><path fill="currentColor" d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.012 8.012 0 0 0 16 8c0-4.42-3.58-8-8-8z"></path></svg> </a> </div> </div> </div> </header> <script>
  const btn = document.querySelector('[data-menu-btn]');
  const panel = document.getElementById('mobile-menu');
  function toggleMenu() {
    if (!panel || !btn) return;
    const isOpen = !panel.classList.contains('hidden');
    if (isOpen) {
      panel.classList.add('hidden');
      btn.setAttribute('aria-expanded', 'false');
    } else {
      panel.classList.remove('hidden');
      btn.setAttribute('aria-expanded', 'true');
    }
  }
  btn?.addEventListener('click', toggleMenu);
  document.addEventListener('keydown', (e) => { if (e.key === 'Escape') {
    if (!panel?.classList.contains('hidden')) toggleMenu();
  }});
  document.addEventListener('click', (e) => {
    if (!panel || !btn) return;
    const target = e.target;
    const clickedInside = panel.contains(target) || btn.contains(target);
    if (!clickedInside && !panel.classList.contains('hidden')) toggleMenu();
  });
</script> <main data-astro-cid-bvzihdzo> <article data-astro-cid-bvzihdzo> <div class="hero-image" data-astro-cid-bvzihdzo>  </div> <div class="prose" data-astro-cid-bvzihdzo> <div class="title" data-astro-cid-bvzihdzo> <div class="date" data-astro-cid-bvzihdzo> <time datetime="2024-09-09T00:00:00.000Z"> Sep 9, 2024 </time>  </div> <h1 data-astro-cid-bvzihdzo>Making a Game Engine in Rust 03: ECS</h1> <hr data-astro-cid-bvzihdzo> </div> <div class="sw-share group flex items-center gap-2"> <!-- <a href={xUrl} target="_blank" rel="noopener noreferrer" class="sw-share-btn" aria-label="Share on X" set:html={xIcon} /> --> <!-- <a href={hnUrl} target="_blank" rel="noopener noreferrer" class="sw-share-btn" aria-label="Share on Hacker News" set:html={hnIcon} /> --> <!-- <a href={liUrl} target="_blank" rel="noopener noreferrer" class="sw-share-btn" aria-label="Share on LinkedIn" set:html={liIcon} /> --> <!-- <a href={rdUrl} target="_blank" rel="noopener noreferrer" class="sw-share-btn" aria-label="Share on Reddit" set:html={rdIcon} /> --> </div> <div class="sw-post-meta flex items-start justify-between gap-4 py-2"> <div class="flex items-start gap-3"> <div class="w-12 h-12 rounded-full overflow-hidden border border-[color:var(--color-border-light)]"> <img src="/_astro/avatar.BQrnOBxq.png" alt="David" width="48" height="48" class="w-full h-full object-cover"> </div> <div class="flex flex-col"> <a href="/blog/author/site-author/" class="text-sm font-semibold text-[color:var(--color-text-primary)] hover:text-[color:var(--accent)]">Site Author</a> <div class="flex items-center gap-3 text-xs text-[color:var(--color-text-muted)]"> <div class="flex items-center gap-1"> <svg viewBox="0 0 24 24" width="14" height="14" aria-hidden="true"><path fill="currentColor" d="M19 3h-1V1h-2v2H8V1H6v2H5c-1.11 0-1.99.9-1.99 2L3 19c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V8h14v11zM7 10h5v5H7z"></path></svg> <time datetime="2024-09-09T00:00:00.000Z"> Sep 9, 2024 </time> </div> <div class="flex items-center gap-1"> <svg viewBox="0 0 24 24" width="14" height="14" aria-hidden="true"> <path fill="currentColor" d="M12 22a10 10 0 1 1 0-20 10 10 0 0 1 0 20Zm0-18a8 8 0 1 0 0 16 8 8 0 0 0 0-16Zm1 9h3v-2h-2V7h-2v6Z"></path> </svg> <span>1 min read</span> </div> </div> </div> </div> </div>  <p>I know it’s been some time since the last post, but I’ve been busy working on the ECS (Entity-Component-System). It took a while to get right, but I’ve finally finished a basic, yet usable, implementation that will be crucial for future features in the game engine.</p>
<h2 id="what-is-ecs">What is ECS?</h2>
<p><strong>ECS</strong>, or <strong>Entity-Component-System</strong>, is a design pattern used primarily in game development. It separates the data (components) from the behavior (systems) and applies it to the entities within the game world. This pattern allows for a more flexible, scalable, and efficient way to manage game objects and their interactions.</p>
<p>In an ECS:</p>
<ul>
<li><strong>Entities</strong> are the objects in your game (e.g., players, enemies, projectiles).</li>
<li><strong>Components</strong> are the data associated with entities (e.g., position, velocity, health).</li>
<li><strong>Systems</strong> operate on entities with specific components, defining the game’s behavior (e.g., movement system updates positions, collision system checks for overlaps).</li>
</ul>
<p>ECS is particularly beneficial because it allows for better cache efficiency and more modular code. You can add, remove, or modify components and systems without affecting other parts of the game, making the engine more maintainable.</p>
<h2 id="how-its-implemented">How It’s Implemented</h2>
<p>To implement ECS, I created a struct called <code>World</code>, which acts as the main structure that the end-user interacts with. The <code>World</code> struct contains three primary components:</p>
<ul>
<li><strong>Resources:</strong> A struct that stores all the resources used in the game.</li>
<li><strong>Entities:</strong> A struct that manages all the entities and their associated components.</li>
<li><strong>Systems:</strong> A struct that holds all the systems responsible for game logic.</li>
</ul>
<p>The <code>World</code> struct provides methods that simplify interactions with these underlying components, making it easier for the user to work with the ECS framework.</p>
<h2 id="how-it-works">How It Works</h2>
<p>One of the main challenges in ECS is allowing the user to access resources across different parts of the game. If we used simple references, we’d run into issues where multiple references require mutability, which Rust’s safety guarantees won’t allow.</p>
<p>To solve this, I utilized <strong>smart pointers</strong>—specifically, <code>Rc</code> and <code>RefCell</code>. These allow for <em>interior mutability</em>, meaning that while multiple references can exist, only one can be mutable at any given time. This approach ensures safety while allowing different parts of the program to modify and read shared data like the game’s score or state.</p>
<p><em>Tip:</em> If you’re familiar with Rust, you might know about <code>Arc</code>, a multithreaded version of <code>Rc</code>. However, since I’m not focusing on multithreading right now, <code>Arc</code> isn’t necessary—at least for the time being.</p>
<h3 id="resources">Resources</h3>
<p>The resources implementation is fairly simple. It’s just a struct with a <strong>HashMap</strong> that stores all the game’s resources, with the key being the type ID of the resource. I’ve added some methods to make resource retrieval easier, so working with resources is straightforward and efficient.</p>
<h3 id="entities">Entities</h3>
<p>The entity system is a bit more complex. Essentially, entities are stored in a large table where each row represents a different component, and each column corresponds to an entity.</p>
<p>Here’s a simple example:</p>













































<table><thead><tr><th></th><th align="center"><strong>0</strong></th><th align="center"><strong>1</strong></th><th align="center"><strong>2</strong></th><th align="center"><strong>3</strong></th><th><strong>…</strong></th></tr></thead><tbody><tr><td><strong>Location</strong></td><td align="center">(2,3)</td><td align="center">(0,0)</td><td align="center">(182, 12)</td><td align="center">(800, 800)</td><td>…</td></tr><tr><td><strong>Speed</strong></td><td align="center">(1, 0)</td><td align="center"></td><td align="center"></td><td align="center">(-2, 1)</td><td>…</td></tr><tr><td><strong>Health</strong></td><td align="center">100</td><td align="center"></td><td align="center">57</td><td align="center"></td><td>…</td></tr><tr><td>…</td><td align="center">…</td><td align="center">…</td><td align="center">…</td><td align="center">…</td><td>…</td></tr></tbody></table>
<p>Not all entities have all components, so the challenge is efficiently determining which components an entity has without wasting time.</p>
<p>To address this, I implemented <strong>bitmasks</strong>. Each component type is assigned a unique bitmask, which is bit-shifted according to its index. For example:</p>
<ul>
<li><strong>Location:</strong> <code>00000001</code></li>
<li><strong>Speed:</strong> <code>00000010</code></li>
<li><strong>Health:</strong> <code>00000100</code></li>
</ul>
<p>Each entity then has a map that stores a combination of these bitmasks, representing which components it possesses. This approach uses a bit more memory but significantly improves the efficiency of querying components.</p>
<p>For example, based on the table above, the bitmask for the first entity would be <code>00000111</code>, for the second entity <code>00000001</code>, and for the third <code>00000101</code>.</p>
<h3 id="systems">Systems</h3>
<p>The last part of the ECS is the <strong>systems</strong>. Systems work similarly to entities but are much simpler. Each system operates on specific components, and it includes at least one method that gets called to update the game state based on the components it interacts with.</p>
<h2 id="whats-next">What’s Next?</h2>
<p>So that’s what I’ve been working on lately—getting the ECS up and running. It’s a crucial part of the game engine and will serve as the foundation for many other features. In the next post, I’ll probably talk about the renderer, but I might dive into the math library first. We’ll see how it goes.</p>
<p><em>Stay tuned, and thanks for following along!</em></p>  <nav class="sw-post-nav mt-8 pt-4 border-t border-[color:var(--color-border-light)]"><div class="flex flex-col md:flex-row md:justify-between gap-3 md:gap-4"><a href="/blog/making-a-game-engine-in-rust-02-first-steps/" class="sw-nav-btn no-underline flex-1"><svg viewBox="0 0 24 24" width="16" height="16" aria-hidden="true"><path fill="currentColor" d="M15.41 7.41 14 6l-6 6 6 6 1.41-1.41L10.83 12z"></path></svg><div class="sw-nav-text"><span class="sw-nav-label">Previous</span><span class="truncate">Making a Game Engine in Rust 02: First Steps</span></div></a><span></span></div></nav> </div> </article> </main> <!-- <Footer /> --> </body></html>