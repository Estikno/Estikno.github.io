<!DOCTYPE html><html lang="en" data-theme="dark" class="dark" data-astro-cid-bvzihdzo> <head><!-- Global Metadata --><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png?v=1"><link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png?v=1"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png?v=1"><link rel="icon" type="image/png" href="/favicon.png?v=1"><link rel="shortcut icon" href="/favicon.ico?v=1"><link rel="sitemap" href="/sitemap-index.xml"><link rel="alternate" type="application/rss+xml" title="Site Author – Personal Blog &#38; Portfolio" href="https://example.com/rss.xml"><meta name="generator" content="Astro v5.12.9"><!-- Font preloads --><link rel="preload" href="/fonts/atkinson-regular.woff" as="font" type="font/woff" crossorigin><link rel="preload" href="/fonts/atkinson-bold.woff" as="font" type="font/woff" crossorigin><!-- Canonical URL --><link rel="canonical" href="https://example.com/blog/building-a-unixshell-in-rust-part-1/"><!-- Robots --><meta name="robots" content="index,follow,max-image-preview:large"><!-- Theme color (supports dark/light) --><meta name="theme-color" media="(prefers-color-scheme: light)" content="#ffffff"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#0b0b0b"><!-- Primary Meta Tags --><title>Building a Unix-shell in Rust - Part 1</title><meta name="title" content="Building a Unix-shell in Rust - Part 1"><meta name="description" content="This is the first part of a series were I'll build a Unix shell in rust."><!-- Open Graph / Facebook --><meta property="og:type" content="website"><meta property="og:site_name" content="Site Author – Personal Blog &#38; Portfolio"><meta property="og:locale" content="en_US"><meta property="og:url" content="https://example.com/blog/building-a-unixshell-in-rust-part-1/"><meta property="og:title" content="Building a Unix-shell in Rust - Part 1"><meta property="og:description" content="This is the first part of a series were I'll build a Unix shell in rust."><meta property="og:image" content="https://example.com/_astro/ShellPhoto.gsyqkmHT.png"><meta property="og:image:alt" content="Building a Unix-shell in Rust - Part 1"><!-- Twitter --><meta name="twitter:card" content="summary_large_image"><meta name="twitter:site" content="@guihubie"><meta property="twitter:url" content="https://example.com/blog/building-a-unixshell-in-rust-part-1/"><meta property="twitter:title" content="Building a Unix-shell in Rust - Part 1"><meta property="twitter:description" content="This is the first part of a series were I'll build a Unix shell in rust."><meta property="twitter:image" content="https://example.com/_astro/ShellPhoto.gsyqkmHT.png"><meta property="og:type" content="article"><!-- Article specific OG meta --><meta property="article:published_time" content="2024-07-22T00:00:00.000Z"><meta property="article:author" content="Site Author"><meta property="article:tag" content="rust"><meta property="article:tag" content="shell"><!-- JSON-LD: Article --><script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"Building a Unix-shell in Rust - Part 1","description":"This is the first part of a series were I'll build a Unix shell in rust.","image":"https://example.com/_astro/ShellPhoto.gsyqkmHT.png","datePublished":"2024-07-22T00:00:00.000Z","author":[{"@type":"Person","name":"Site Author"}],"publisher":{"@type":"Organization","name":"guihubie.com"},"mainEntityOfPage":"https://example.com/blog/building-a-unixshell-in-rust-part-1/","url":"https://example.com/blog/building-a-unixshell-in-rust-part-1/"}</script><!-- JSON-LD: Breadcrumbs --><script type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Home","item":"https://example.com/"},{"@type":"ListItem","position":2,"name":"Blog","item":"https://example.com/blog/"},{"@type":"ListItem","position":3,"name":"Building a Unix-shell in Rust - Part 1","item":"https://example.com/blog/building-a-unixshell-in-rust-part-1/"}]}</script><link rel="stylesheet" href="/_astro/about.DsQLGK1y.css">
<style>main[data-astro-cid-bvzihdzo]{width:1280px;max-width:calc(100% - 2em);margin:auto;background:var(--color-bg-primary)}.hero-image[data-astro-cid-bvzihdzo]{width:100%}.hero-image[data-astro-cid-bvzihdzo] img[data-astro-cid-bvzihdzo]{display:block;margin:0 auto;border-radius:12px;box-shadow:var(--box-shadow)}.prose[data-astro-cid-bvzihdzo]{width:100%;max-width:870px;margin:auto;padding:.05em;color:var(--color-text-secondary)}.title[data-astro-cid-bvzihdzo]{margin-bottom:1em;padding:1em 0;text-align:center;line-height:1}.title[data-astro-cid-bvzihdzo] h1[data-astro-cid-bvzihdzo]{margin:0 0 .5em;color:var(--color-text-primary)}.date[data-astro-cid-bvzihdzo]{margin-bottom:.5em;color:var(--color-text-muted)}.last-updated-on[data-astro-cid-bvzihdzo]{font-style:italic}
</style></head> <body data-astro-cid-bvzihdzo> <header class="bg-background text-foreground border-b sw-header"> <nav class="mx-auto max-w-6xl px-4 py-2 flex items-center justify-between"> <div class="flex items-center gap-3"> <a class="no-underline hover:opacity-90 flex items-center gap-2" href="/" aria-label="Home"> <img src="/favicon.png?v=1" alt="" aria-hidden="true" width="45" height="45"> </a> <div class="internal-links hidden md:flex items-center gap-2 ml-1"> <a href="/" class="px-2 py-3 text-[color:var(--color-text-secondary)] no-underline" data-astro-cid-2dpnh6aj> Home </a>  <a href="/portfolio" class="px-2 py-3 text-[color:var(--color-text-secondary)] no-underline" data-astro-cid-2dpnh6aj> Portfolio </a>  <a href="/about" class="px-2 py-3 text-[color:var(--color-text-secondary)] no-underline" data-astro-cid-2dpnh6aj> About </a>  <a href="/blog" class="px-2 py-3 text-[color:var(--color-text-secondary)] no-underline active" data-astro-cid-2dpnh6aj> Blog </a>  <!-- <a href="#contact" class="px-2 py-3 text-[color:var(--color-text-secondary)] no-underline">Contact</a> --> </div> </div> <div class="flex items-center gap-3"> <div class="social-links hidden md:flex items-center gap-3"> <!-- <a href="https://x.com/guihubie" target="_blank" class="group text-[color:var(--color-text-secondary)]"> --> <!-- <span class="sr-only">Follow on Twitter</span> --> <!-- X icon --> <!-- <svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="transition-colors group-hover:text-[color:var(--accent)]"><path fill="currentColor" d="M18.146 3H21l-7.5 8.574L22.5 21h-6.297l-4.93-5.597L5.5 21H3l8.106-9.266L3 3h6.453l4.466 5.07L18.146 3Zm-1.103 16.2h1.705L7.05 4.64H5.272l11.771 14.56Z"/></svg> --> <!-- </a> --> <a href="https://github.com/Estikno" target="_blank" class="group text-[color:var(--color-text-secondary)]"> <span class="sr-only">Go to GitHub</span> <svg viewBox="0 0 16 16" aria-hidden="true" width="24" height="24" class="transition-colors group-hover:text-[color:var(--accent)]"><path fill="currentColor" d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.012 8.012 0 0 0 16 8c0-4.42-3.58-8-8-8z"></path></svg> </a> </div> <button type="button" class="sw-btn-sm no-underline flex items-center gap-1" aria-label="Toggle theme" aria-pressed="false" data-theme-toggle> <span class="sr-only">Toggle theme</span> <span class="theme-icon" aria-hidden="true"> <svg class="icon-sun" viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="4"></circle><path d="M12 2v2M12 20v2M4.93 4.93l1.41 1.41M17.66 17.66l1.41 1.41M2 12h2M20 12h2M4.93 19.07l1.41-1.41M17.66 6.34l1.41-1.41"></path></svg> <svg class="icon-moon" viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg> </span> <span class="label">Theme</span> </button> <script>
  (function () {
    const storageKey = 'theme';
    const root = document.documentElement;
    const btn = document.querySelector('[data-theme-toggle]');

    function applyTheme(theme) {
      const isDark = theme === 'dark';
      root.dataset.theme = isDark ? 'dark' : 'light';
      root.classList.toggle('dark', isDark);
      if (btn) btn.setAttribute('aria-pressed', String(isDark));
    }

    function getInitialTheme() {
      const saved = localStorage.getItem(storageKey);
      if (saved === 'dark' || saved === 'light') return saved;
      // Infer from current DOM as fallback
      return root.classList.contains('dark') || root.dataset.theme === 'dark' ? 'dark' : 'light';
    }

    let current = getInitialTheme();
    applyTheme(current);

    btn?.addEventListener('click', () => {
      current = current === 'dark' ? 'light' : 'dark';
      localStorage.setItem(storageKey, current);
      applyTheme(current);
    });
  })();
</script> <style>
  [data-theme-toggle] .icon-moon { display: none; }
  html[data-theme="dark"] [data-theme-toggle] .icon-sun { display: none; }
  html[data-theme="dark"] [data-theme-toggle] .icon-moon { display: inline; }
</style> <button type="button" aria-label="Open menu" aria-controls="mobile-menu" aria-expanded="false" data-menu-btn class="md:hidden inline-flex items-center justify-center w-10 h-10 rounded-lg text-[color:var(--color-text-secondary)] hover:text-white"> <svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true"><path fill="currentColor" d="M3 6h18v2H3V6Zm0 5h18v2H3v-2Zm0 5h18v2H3v-2Z"></path></svg> </button> </div> </nav> <div id="mobile-menu" class="md:hidden hidden border-t"> <div class="mx-auto max-w-6xl px-4 py-3 flex flex-col gap-2"> <div class="flex flex-col"> <a href="/" class="px-2 py-3" data-astro-cid-2dpnh6aj> Resume </a>  <a href="/portfolio" class="px-2 py-3" data-astro-cid-2dpnh6aj> Portfolio </a>  <a href="/about" class="px-2 py-3" data-astro-cid-2dpnh6aj> About </a>  <a href="/blog" class="px-2 py-3 active" data-astro-cid-2dpnh6aj> Blog </a>  <a href="#contact" class="px-2 py-3">Contact</a> </div> <div class="flex items-center gap-4 pt-2"> <a href="https://x.com/guihubie" target="_blank" class="group inline-flex items-center text-[color:var(--color-text-secondary)]"> <svg viewBox="0 0 24 24" width="22" height="22" aria-hidden="true" class="transition-colors group-hover:text-white"><path fill="currentColor" d="M18.146 3H21l-7.5 8.574L22.5 21h-6.297l-4.93-5.597L5.5 21H3l8.106-9.266L3 3h6.453l4.466 5.07L18.146 3Zm-1.103 16.2h1.705L7.05 4.64H5.272l11.771 14.56Z"></path></svg> </a> <a href="https://github.com/guihubie/free-astro-template" target="_blank" class="group inline-flex items-center text-[color:var(--color-text-secondary)]"> <svg viewBox="0 0 16 16" aria-hidden="true" width="22" height="22" class="transition-colors group-hover:text-white"><path fill="currentColor" d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.012 8.012 0 0 0 16 8c0-4.42-3.58-8-8-8z"></path></svg> </a> </div> </div> </div> </header> <script>
  const btn = document.querySelector('[data-menu-btn]');
  const panel = document.getElementById('mobile-menu');
  function toggleMenu() {
    if (!panel || !btn) return;
    const isOpen = !panel.classList.contains('hidden');
    if (isOpen) {
      panel.classList.add('hidden');
      btn.setAttribute('aria-expanded', 'false');
    } else {
      panel.classList.remove('hidden');
      btn.setAttribute('aria-expanded', 'true');
    }
  }
  btn?.addEventListener('click', toggleMenu);
  document.addEventListener('keydown', (e) => { if (e.key === 'Escape') {
    if (!panel?.classList.contains('hidden')) toggleMenu();
  }});
  document.addEventListener('click', (e) => {
    if (!panel || !btn) return;
    const target = e.target;
    const clickedInside = panel.contains(target) || btn.contains(target);
    if (!clickedInside && !panel.classList.contains('hidden')) toggleMenu();
  });
</script> <main data-astro-cid-bvzihdzo> <article data-astro-cid-bvzihdzo> <div class="hero-image" data-astro-cid-bvzihdzo> <img src="/_astro/ShellPhoto.gsyqkmHT_ZN9npv.webp" alt data-astro-cid-bvzihdzo="true" loading="lazy" decoding="async" fetchpriority="auto" width="1020" height="510"> </div> <div class="prose" data-astro-cid-bvzihdzo> <div class="title" data-astro-cid-bvzihdzo> <div class="date" data-astro-cid-bvzihdzo> <time datetime="2024-07-22T00:00:00.000Z"> Jul 22, 2024 </time>  </div> <h1 data-astro-cid-bvzihdzo>Building a Unix-shell in Rust - Part 1</h1> <hr data-astro-cid-bvzihdzo> </div> <div class="sw-share group flex items-center gap-2"> <!-- <a href={xUrl} target="_blank" rel="noopener noreferrer" class="sw-share-btn" aria-label="Share on X" set:html={xIcon} /> --> <!-- <a href={hnUrl} target="_blank" rel="noopener noreferrer" class="sw-share-btn" aria-label="Share on Hacker News" set:html={hnIcon} /> --> <!-- <a href={liUrl} target="_blank" rel="noopener noreferrer" class="sw-share-btn" aria-label="Share on LinkedIn" set:html={liIcon} /> --> <!-- <a href={rdUrl} target="_blank" rel="noopener noreferrer" class="sw-share-btn" aria-label="Share on Reddit" set:html={rdIcon} /> --> </div> <div class="sw-post-meta flex items-start justify-between gap-4 py-2"> <div class="flex items-start gap-3"> <div class="w-12 h-12 rounded-full overflow-hidden border border-[color:var(--color-border-light)]"> <img src="/_astro/avatar.BQrnOBxq.png" alt="David" width="48" height="48" class="w-full h-full object-cover"> </div> <div class="flex flex-col"> <a href="/blog/author/site-author/" class="text-sm font-semibold text-[color:var(--color-text-primary)] hover:text-[color:var(--accent)]">Site Author</a> <div class="flex items-center gap-3 text-xs text-[color:var(--color-text-muted)]"> <div class="flex items-center gap-1"> <svg viewBox="0 0 24 24" width="14" height="14" aria-hidden="true"><path fill="currentColor" d="M19 3h-1V1h-2v2H8V1H6v2H5c-1.11 0-1.99.9-1.99 2L3 19c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V8h14v11zM7 10h5v5H7z"></path></svg> <time datetime="2024-07-22T00:00:00.000Z"> Jul 22, 2024 </time> </div> <div class="flex items-center gap-1"> <svg viewBox="0 0 24 24" width="14" height="14" aria-hidden="true"> <path fill="currentColor" d="M12 22a10 10 0 1 1 0-20 10 10 0 0 1 0 20Zm0-18a8 8 0 1 0 0 16 8 8 0 0 0 0-16Zm1 9h3v-2h-2V7h-2v6Z"></path> </svg> <span>1 min read</span> </div> </div> </div> </div> </div>  <p>Throughout this year and last one, I haven’t stopped hearing how amazing Rust is and how awesome its developer experience is. In addition, Rust was ranked as one of the most loved programming languages in 2023. So, it was time to learn it and see why people praise it so much.</p>
<p>To do that, I decided to build a Unix shell in Rust. It seems like a good starter project, and I use the terminal and shell commands a lot in my day-to-day tasks. It seemed like the perfect idea—not only to learn the language but also to understand how a shell works and what makes them so useful.</p>
<h2 id="whats-a-shell">What’s a Shell?</h2>
<p>Before we dive into development, it’s important to know what a shell is. There’s often confusion among people when differentiating between a Shell, Terminal, and Prompt.</p>
<p>Here’s a brief explanation of each concept:</p>
<ul>
<li><strong>Terminal:</strong> The terminal emulator (often just called terminal) is “the window” that displays the characters you type and sends them to the shell. It also shows the shell’s output in the window.</li>
<li><strong>Shell:</strong> A shell is a program that allows you to control your computer more easily than manually doing it. It’s responsible for executing the commands you type.</li>
<li><strong>Prompt:</strong> The prompt is just the line where you write the instructions for the shell. It’s what you can mainly customize to your liking via third-party scripts, such as oh-my-posh, oh-my-zsh, etc.</li>
</ul>
<p>Some examples of Unix shells, like the kind we’re making, are:</p>
<ul>
<li>Bourne-shell (sh)</li>
<li>bash</li>
<li>zsh</li>
<li>fish</li>
</ul>
<p>Or the Windows-specific shells, which are confusingly both the shell and terminal emulator:</p>
<ul>
<li>Command Prompt (cmd)</li>
<li>PowerShell</li>
</ul>
<p>Examples of terminal emulators:</p>
<ul>
<li>xterm</li>
<li>rxvt</li>
<li>Alacritty (which is also written in Rust)</li>
<li>iTerm</li>
<li>Terminal.app</li>
<li>Command Prompt (cmd)</li>
<li>PowerShell</li>
</ul>
<p>The goal is to write a shell similar to bash, as it’s the one I’ve used the most. I’ve also used zsh, but not as extensively as bash.</p>
<h2 id="how-does-a-shell-work">How Does a Shell Work?</h2>
<p>So now that we know what a shell is, how does it work? Well, a shell uses what is called a <strong>REPL (Read-Eval-Print-Loop)</strong>. This means you first type a command in the prompt, which is usually just a dollar sign (<code>$</code>). Then you hit enter to translate the command into an action. The shell executes it, and the output prints to the screen. This loop repeats forever, or until the user closes the terminal.</p>
<p>Here is a diagram that explains more extensively what happens in the shell.
<img alt="Diagram_shell" loading="lazy" decoding="async" fetchpriority="auto" width="800" height="1098" src="/_astro/shell_diagram.B6tPptE-_1aAHYu.webp" ></p>
<p>Lets see this in action with an example using <code>ls</code>:</p>
<ol>
<li>
<p>First, we type the command we want to execute, in this case, <code>ls</code>:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#B392F0">/</span><span style="color:#9ECBFF"> ❯</span><span style="color:#9ECBFF"> ls</span><span style="color:#E1E4E8"> </span></span></code></pre>
</li>
<li>
<p>We hit enter, and the shell executes the command and its output is displayed:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#B392F0">/</span><span style="color:#9ECBFF"> ❯</span><span style="color:#9ECBFF"> ls</span><span style="color:#E1E4E8"> </span></span>
<span class="line"><span style="color:#B392F0">bin</span><span style="color:#9ECBFF">   dev</span><span style="color:#9ECBFF">  home</span><span style="color:#9ECBFF">  lib</span><span style="color:#9ECBFF">    lib64</span><span style="color:#9ECBFF">   lost+found</span><span style="color:#9ECBFF">  mnt</span><span style="color:#9ECBFF">  proc</span><span style="color:#9ECBFF">  run</span><span style="color:#9ECBFF">   snap</span><span style="color:#9ECBFF">  sys</span><span style="color:#9ECBFF">  usr</span></span>
<span class="line"><span style="color:#B392F0">boot</span><span style="color:#9ECBFF">  etc</span><span style="color:#9ECBFF">  init</span><span style="color:#9ECBFF">  lib32</span><span style="color:#9ECBFF">  libx32</span><span style="color:#9ECBFF">  media</span><span style="color:#9ECBFF">       opt</span><span style="color:#9ECBFF">  root</span><span style="color:#9ECBFF">  sbin</span><span style="color:#9ECBFF">  srv</span><span style="color:#9ECBFF">   tmp</span><span style="color:#9ECBFF">  var</span></span></code></pre>
</li>
<li>
<p>At the end of the output, the loop repeats by letting you type another command:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#B392F0">/</span><span style="color:#9ECBFF"> ❯</span><span style="color:#9ECBFF"> ls</span><span style="color:#E1E4E8"> </span></span>
<span class="line"><span style="color:#B392F0">bin</span><span style="color:#9ECBFF">   dev</span><span style="color:#9ECBFF">  home</span><span style="color:#9ECBFF">  lib</span><span style="color:#9ECBFF">    lib64</span><span style="color:#9ECBFF">   lost+found</span><span style="color:#9ECBFF">  mnt</span><span style="color:#9ECBFF">  proc</span><span style="color:#9ECBFF">  run</span><span style="color:#9ECBFF">   snap</span><span style="color:#9ECBFF">  sys</span><span style="color:#9ECBFF">  usr</span></span>
<span class="line"><span style="color:#B392F0">boot</span><span style="color:#9ECBFF">  etc</span><span style="color:#9ECBFF">  init</span><span style="color:#9ECBFF">  lib32</span><span style="color:#9ECBFF">  libx32</span><span style="color:#9ECBFF">  media</span><span style="color:#9ECBFF">       opt</span><span style="color:#9ECBFF">  root</span><span style="color:#9ECBFF">  sbin</span><span style="color:#9ECBFF">  srv</span><span style="color:#9ECBFF">   tmp</span><span style="color:#9ECBFF">  var</span></span>
<span class="line"><span style="color:#B392F0">/</span><span style="color:#9ECBFF"> ❯</span><span style="color:#E1E4E8">  </span></span></code></pre>
</li>
</ol>
<h2 id="architecture-of-our-shell">Architecture of Our Shell</h2>
<p>Before starting to write code, it’s necessary to have everything well organized to be as efficient as possible when programming and to have a general view of the product and how it will be done.</p>
<h3 id="execute-initial-scripts-and-shell-configurations">Execute Initial Scripts and Shell Configurations</h3>
<p>Before starting to read user input, the shell has to read the configuration file. This is done to customize the shell to each user’s preferences.</p>
<p>Although this step will be done later in the series, once all the base of the shell has been established, it is important to keep in mind that customization is crucial.</p>
<h3 id="read-user-input">Read User Input</h3>
<p>After the initial configuration, we start the general loop by reading the user input. Most shells print a symbol to signal to the user that they can input a command.</p>
<p>Next, we need to analyze the user input to determine if it is a built-in command or an external one.</p>
<p>The difference between them is simple: a built-in command is directly handled by the shell itself, instead of executing an external process. In other words, it’s a function call within the shell’s code. An external command is either a binary in one of the directories in your PATH or located in a filesystem path (relative or absolute).</p>













<table><thead><tr><th align="center"><strong>Some Built-in Commands</strong></th><th align="center"><strong>Some External Commands</strong></th></tr></thead><tbody><tr><td align="center"><code>cd</code>, <code>help</code>, <code>echo</code></td><td align="center"><code>grep</code>, <code>wget</code>, <code>curl</code></td></tr></tbody></table>
<p>The most popular example of a built-in command is <code>cd</code>. The reason it must be built-in is that an external program can’t change the environment of the current working directory, so it must be changed by the shell itself. A more in-depth explanation can be found in <a href="https://unix.stackexchange.com/a/38809">this link</a>.</p>
<h3 id="then-we-execute">Then We Execute</h3>
<p>When we use a command that calls a built-in, we simply pass the arguments to the function and return to the start of the loop when it completes.</p>
<h4 id="and-when-we-call-an-executable">And When We Call an Executable?</h4>
<p>We need to make a fork syscall, that is, create a new process for the executable to run in, so it can have its own memory space and manage its interactions with the operating system (The shell is still the parent process).</p>
<h3 id="then-we-process">Then We Process</h3>
<p>This is when we cause side effects to the system.</p>
<p>We want to provide feedback to the user to let them know the results of this process. To keep this simple, we will only consider returning text to the user, as we are providing commands as text.</p>
<p>Our shell process has at least 3 file descriptors for passing input or receiving output: Stdin, Stdout, and Stderr.</p>
<p>After the process is complete, any output should be printed to the screen, via stdout or stderr.</p>
<h3 id="lastly-we-loop">Lastly, We Loop</h3>
<p>Control returns to the user. The default user prompt prints as a visual cue (along with the typical blinking cursor), and we should be able to enter another command.</p>
<h2 id="time-to-code">Time to Code</h2>
<p>Now that we have set the record straight on how the shell is going to work, we can start coding the basics. But that will be explained in the next post. See you next time!</p>  <nav class="sw-post-nav mt-8 pt-4 border-t border-[color:var(--color-border-light)]"><div class="flex flex-col md:flex-row md:justify-between gap-3 md:gap-4"><a href="/blog/making-a-multiplayer-fps-interpolation/" class="sw-nav-btn no-underline flex-1"><svg viewBox="0 0 24 24" width="16" height="16" aria-hidden="true"><path fill="currentColor" d="M15.41 7.41 14 6l-6 6 6 6 1.41-1.41L10.83 12z"></path></svg><div class="sw-nav-text"><span class="sw-nav-label">Previous</span><span class="truncate">Making a Multiplayer FPS: Interpolation</span></div></a><a href="/blog/building-a-unixshell-in-rust-part-2/" class="sw-nav-btn no-underline justify-end flex-1"><div class="sw-nav-text text-right"><span class="sw-nav-label">Next</span><span class="truncate">Building a Unix-shell in Rust - Part 2</span></div><svg viewBox="0 0 24 24" width="16" height="16" aria-hidden="true"><path fill="currentColor" d="m8.59 16.59 1.41 1.41 6-6-6-6-1.41 1.41L13.17 12z"></path></svg></a></div></nav> </div> </article> </main> <!-- <Footer /> --> </body></html>